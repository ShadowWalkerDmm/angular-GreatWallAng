<div class="container">

  <!-- list -->
  <div class="container">
    <table class="table table-bordered caption-top">
      <caption>
        <h1 class="mt-5"><strong>GESTION DES PROTES</strong></h1>
      </caption>
      <thead class="table-dark">
        <tr>
          <th scope="col">Porte</th>
          <th scope="col">name</th>
          <th scope="col">state</th>
          <!-- <th scope="col">dateTime</th> -->
          <th scope="col">actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let one_doorstatus of les_doorstatuss">
          <td>
            <div class="frameDoor">
              <div class="door door1 " style="float:left" [ngClass]="{'doorOpen1' : one_doorstatus.state == 'opened' }">
                <img [src]="one_doorstatus.pic">
              </div>
              <div class="door door2" style="float:right" [ngClass]="{'doorOpen2' : one_doorstatus.state == 'opened'}">
                <img [src]="one_doorstatus.pic">
              </div>
            </div>
          </td>
          <td class="align-items-center">{{one_doorstatus.name}}</td>
          <td>{{one_doorstatus.state}}</td>
          <!-- <td>{{one_doorstatus.dateTime}}</td> -->
          <td>
            <button class="btn btn-outline-info" (click)="on_click_edit(one_doorstatus)" data-bs-toggle="modal"
              data-bs-target="#modal_opened">
              {{one_doorstatus.state == "opened"? "closed" : "opened"}}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="container mb-3">
      <div class="row g-2">
        <!-- Doors -->
        <div class="col-md">
          <div class="form-floating">
            <select class="form-select" id="floatingSelectGrid" [(ngModel)]="filterCriteria.idDoor">
              <option value="">All</option>
              @for (item of les_doorstatuss; track $index) {
              <option value="{{item.id}}">{{item.name}}</option>
              }
            </select>
            <label for="floatingSelectGrid">States</label>
          </div>
        </div>
        <!-- states -->
        <div class="col-md">
          <div class="form-floating">
            <select class="form-select" id="floatingSelectGrid" [(ngModel)]="filterCriteria.state">
              <option value="">All</option>
              <option value="opened">Opened</option>
              <option value="closed">Closed</option>
            </select>
            <label for="floatingSelectGrid">States</label>
          </div>
        </div>
        <!-- Date/Time from -->
        <div class="col-md">
          <div class="form-floating">
            <input [(ngModel)]="filterCriteria.dateFrom" type="datetime-local" class="form-control"
              id="floatingInputGrid">
            <label for="floatingInputGrid">Date/Time From</label>
          </div>
        </div>
        <!-- Date/time to -->
        <div class="col-md">
          <div class="form-floating">
            <input [(ngModel)]="filterCriteria.dateTo" type="datetime-local" class="form-control"
              id="floatingInputGrid">
            <label for="floatingInputGrid">Date/Time TO</label>
          </div>
        </div>
        <!-- button -->
        <button class="btn btn-outline-success" (click)="filterData()">Filter</button>
      </div>
    </div>
    <!-- display of historique -->
    <div style="max-height: 400px; overflow-y: auto;">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th scope="col">Num</th>
            <th scope="col">User</th>
            <th scope="col">Door</th>
            <th scope="col">Action</th>
            <th scope="col">Date/time</th>
          </tr>
        </thead>
        <tbody>
          @for (door of filteredData; track $index) {
          <tr>
            <td>{{$index +1}}</td>
            <td>{{door.firstName}}</td>
            <td>{{door.name}}</td>
            <td>{{door.state}}</td>
            <td>({{api.format_date(door.updated_at).full_datetime}})</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>


  <!-- ajout -->
  <div class="modal fade" id="modal_add_doorstatus" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header ">
          <h1 class="modal-title fs-5">Ajouter Doorstatus</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" #closeDoorModal></button>
        </div>
        <div class="modal-body">
          <app-add-doorstatus (cb_add_doorstatus)="after_add($event)"></app-add-doorstatus>
        </div>
      </div>
    </div>
  </div>
  <!-- opened -->
  <div class="modal fade" id="modal_opened" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header ">
          <h1 class="modal-title fs-5"> {{"Voulez-vous "}}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            #closeEditDoorModal></button>
        </div>
        <div class="modal-body">
          <h2></h2>
          <app-edit-doorstatus *ngIf="doorstatus_to_edit" (cb_edit_doorstatus)="after_edit($event)"
            [doorstatus_to_edit]="doorstatus_to_edit"></app-edit-doorstatus>
          <!-- <app-add-doorhistorique *ngIf="doorstatus_to_edit" [idDoor]="doorstatus_to_edit.id" [state]="'opened'"
          (cb_add_doorhistorique)="after_open($event)" /> -->
        </div>
      </div>
    </div>
  </div>
</div>